!function(a,c){function t(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.islike=!1,this.len=0,this.rotateTimer=null,this.curIndex=0}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json")},getDom:function(){this.record=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData:function(t){var i=this;a.ajax({url:t,method:"get",success:function(t){i.dataList=t,i.listPlay(),i.len=i.dataList.length,i.indexObj=new c.indexControl(i.len),i.loadMusic(i.indexObj.index),i.musicControl()},error:function(){}})},loadMusic:function(t){c.render(this.dataList[t]),c.pro.renderAlltime(this.dataList[t].duration),c.music.Load(this.dataList[t].audioSrc),"play"==c.music.status&&(c.music.Play(),c.pro.start(0),this.imgRotate(0),this.controlBtns[2].className="playing"),this.list.changeSelect(t),this.curIndex=t},musicControl:function(){var n=this;this.controlBtns[0].addEventListener("touchend",function(){c.music.islike?this.className="":this.className="liking",c.music.islike=!c.music.islike}),this.controlBtns[1].addEventListener("touchend",function(){c.music.status="play",n.loadMusic(n.indexObj.prev())}),this.controlBtns[2].addEventListener("touchend",function(){var t;"play"==c.music.status?(c.music.Pause(),c.pro.stop(),this.className="",n.imgStop()):(c.music.Play(),c.pro.start(),this.className="playing",t=n.record.dataset.rotate||0,n.imgRotate(t))}),this.controlBtns[3].addEventListener("touchend",function(){c.music.status="play",n.loadMusic(n.indexObj.next())});var t=a(".backBg").offset(),e=t.left,o=t.width;a(".circle").on("touchstart",function(){c.pro.stop()}).on("touchmove",function(t){var i=(t.changedTouches[0].clientX-e)/o;0<i&&i<1&&c.pro.upDate(i)}).on("touchend",function(t){var i,s=(t.changedTouches[0].clientX-e)/o;0<s&&s<1&&(i=s*n.dataList[n.indexObj.index].duration,c.music.PlayTo(i),c.music.status="play",c.muted=!0,c.music.Play(),a(".play").addClass("playing"),c.pro.start(s))})},imgRotate:function(t){var i=this;clearInterval(this.rotateTimer),this.rotateTimer=setInterval(function(){t=+t+.2,i.record.style.transform="rotate("+t+"deg)",i.record.dataset.rotate=t},1e3/60)},imgStop:function(){clearInterval(this.rotateTimer)},listPlay:function(){var s=this;this.list=c.listcontrol(this.dataList,this.wrap),this.controlBtns[4].addEventListener("touchend",function(){s.list.slideUp()}),this.list.musicList.forEach(function(t,i){t.addEventListener("touchend",function(){s.curIndex!=i&&(c.music.status="play",s.indexObj.index=i,s.loadMusic(i),s.list.slideDown())})})}},new t(document.getElementById("wrap")).init()}(window.Zepto,window.player);